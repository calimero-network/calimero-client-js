{
  "schema_version": "wasm-abi/1",
  "types": {
    "AbiState": {
      "kind": "record",
      "fields": [
        {
          "name": "counter",
          "type": { "kind": "u32" }
        },
        {
          "name": "last_updated",
          "type": { "kind": "u64" }
        },
        {
          "name": "active",
          "type": { "kind": "bool" }
        }
      ]
    },
    "Person": {
      "kind": "record",
      "fields": [
        {
          "name": "id",
          "type": { "$ref": "UserId32" }
        },
        {
          "name": "name",
          "type": { "kind": "string" }
        },
        {
          "name": "age",
          "type": { "kind": "u32" }
        },
        {
          "name": "email",
          "type": { "kind": "string" },
          "nullable": true
        },
        {
          "name": "profile",
          "type": { "$ref": "Profile" }
        }
      ]
    },
    "Profile": {
      "kind": "record",
      "fields": [
        {
          "name": "bio",
          "type": { "kind": "string" },
          "nullable": true
        },
        {
          "name": "avatar_hash",
          "type": { "$ref": "Hash64" }
        },
        {
          "name": "preferences",
          "type": {
            "kind": "map",
            "key": { "kind": "string" },
            "value": { "kind": "string" }
          }
        }
      ]
    },
    "Action": {
      "kind": "variant",
      "variants": [
        {
          "name": "Create",
          "code": "CREATE",
          "payload": { "$ref": "Person" }
        },
        {
          "name": "Update",
          "code": "UPDATE",
          "payload": {
            "kind": "record",
            "fields": [
              { "name": "id", "type": { "$ref": "UserId32" } },
              { "name": "changes", "type": { "kind": "string" } }
            ]
          }
        },
        {
          "name": "Delete",
          "code": "DELETE",
          "payload": { "$ref": "UserId32" }
        }
      ]
    },
    "ConformanceError": {
      "kind": "variant",
      "variants": [
        {
          "name": "NotFound",
          "code": "NOT_FOUND",
          "payload": {
            "kind": "record",
            "fields": [
              { "name": "resource", "type": { "kind": "string" } },
              { "name": "id", "type": { "kind": "string" } }
            ]
          }
        },
        {
          "name": "InvalidInput",
          "code": "INVALID_INPUT",
          "payload": { "kind": "string" }
        },
        {
          "name": "InternalError",
          "code": "INTERNAL_ERROR"
        }
      ]
    },
    "UserId32": {
      "kind": "bytes",
      "size": 32,
      "encoding": "hex"
    },
    "Hash64": {
      "kind": "bytes",
      "size": 64,
      "encoding": "hex"
    }
  },
  "methods": [
    {
      "name": "opt_u32",
      "params": [
        {
          "name": "value",
          "type": { "kind": "u32" },
          "nullable": true
        }
      ],
      "returns": { "kind": "u32" },
      "returns_nullable": true
    },
    {
      "name": "list_u32",
      "params": [
        {
          "name": "values",
          "type": {
            "kind": "list",
            "items": { "kind": "u32" }
          }
        }
      ],
      "returns": {
        "kind": "list",
        "items": { "kind": "u32" }
      }
    },
    {
      "name": "map_u32",
      "params": [
        {
          "name": "data",
          "type": {
            "kind": "map",
            "key": { "kind": "string" },
            "value": { "kind": "u32" }
          }
        }
      ],
      "returns": {
        "kind": "map",
        "key": { "kind": "string" },
        "value": { "kind": "u32" }
      }
    },
    {
      "name": "make_person",
      "params": [
        {
          "name": "name",
          "type": { "kind": "string" }
        },
        {
          "name": "age",
          "type": { "kind": "u32" }
        },
        {
          "name": "email",
          "type": { "kind": "string" },
          "nullable": true
        }
      ],
      "returns": { "$ref": "Person" },
      "errors": [
        {
          "code": "INVALID_AGE",
          "payload": { "kind": "string" }
        },
        {
          "code": "NAME_TOO_LONG"
        }
      ]
    },
    {
      "name": "profile_roundtrip",
      "params": [
        {
          "name": "profile",
          "type": { "$ref": "Profile" }
        }
      ],
      "returns": { "$ref": "Profile" }
    },
    {
      "name": "act",
      "params": [
        {
          "name": "action",
          "type": { "$ref": "Action" }
        }
      ],
      "returns": { "kind": "unit" },
      "errors": [
        {
          "code": "ACTION_FAILED",
          "payload": { "$ref": "ConformanceError" }
        }
      ]
    },
    {
      "name": "roundtrip_id",
      "params": [
        {
          "name": "id",
          "type": { "$ref": "UserId32" }
        }
      ],
      "returns": { "$ref": "UserId32" }
    },
    {
      "name": "roundtrip_hash",
      "params": [
        {
          "name": "hash",
          "type": { "$ref": "Hash64" }
        }
      ],
      "returns": { "$ref": "Hash64" }
    },
    {
      "name": "may_fail",
      "params": [
        {
          "name": "should_fail",
          "type": { "kind": "bool" }
        }
      ],
      "returns": { "kind": "string" },
      "errors": [
        {
          "code": "INTENTIONAL_FAILURE",
          "payload": { "kind": "string" }
        }
      ]
    },
    {
      "name": "find_person",
      "params": [
        {
          "name": "id",
          "type": { "$ref": "UserId32" }
        }
      ],
      "returns": { "$ref": "Person" },
      "returns_nullable": true,
      "errors": [
        {
          "code": "PERSON_NOT_FOUND",
          "payload": { "$ref": "ConformanceError" }
        }
      ]
    }
  ],
  "events": [
    {
      "name": "Ping",
      "payload": { "kind": "unit" }
    },
    {
      "name": "Named",
      "payload": { "kind": "string" }
    },
    {
      "name": "Data",
      "payload": { "kind": "bytes", "encoding": "hex" }
    },
    {
      "name": "PersonUpdated",
      "payload": {
        "kind": "record",
        "fields": [
          { "name": "person", "type": { "$ref": "Person" } },
          { "name": "timestamp", "type": { "kind": "u64" } }
        ]
      }
    },
    {
      "name": "ActionTaken",
      "payload": {
        "kind": "record",
        "fields": [
          { "name": "action", "type": { "$ref": "Action" } },
          { "name": "actor", "type": { "$ref": "UserId32" } },
          { "name": "success", "type": { "kind": "bool" } }
        ]
      }
    }
  ]
}
